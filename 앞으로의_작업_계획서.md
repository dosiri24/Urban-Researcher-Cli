# AI 기반 '가상 랩 미팅' CLI — 앞으로의 작업 계획서

작성일: 2025-08-30
문서 버전: 0.1 (초안)

## 문서 목적 및 사용 방법
- 목적: 도시 연구 자동화 CLI(가상 랩 미팅)의 개발을 AI 보조 도구가 수행·추적할 수 있도록, 단계(Phase) → 과업(Task) 단위로 최대한 세분화한 실행 계획을 제공합니다.
- 사용: 각 과업의 `상태`와 `개발 코멘트` 칸을 빌드/실행 후 갱신하세요. 상태 값 권장: `Planned`, `InProgress`, `Blocked`, `Done`.
- 표기 규칙: 과업 ID는 `PX-TYY` 형식(P=Phase, X=번호, T=Task, YY=순번)을 사용합니다. 예) P1-T03

## 시스템 개요(요약)
- The Shell(CLI): 연구자와 상호작용하는 인터페이스, 모듈·파이프라인 중심 설계
- The Brain(MCP): 다중 에이전트(대학원생/지도교수)가 토론하며 나선형 루프로 연구 고도화

---

## 개발 원칙 및 순서(Shell-First 전략)
- 우선순위: CLI 틀(입출력/옵션/로깅/에러/프로젝트/설정)을 안정화한 뒤 MCP 도구를 “하나씩” 증분 통합합니다.
- 격리: 신규 도구는 기본 비활성화. `--enable-<tool>` 또는 설정 플래그로만 켭니다.
- 호환성: CLI 공개 인터페이스와 도구 등록 규약을 고정하고, 파손 변경은 버저닝/마이그레이션 노트를 동반합니다.
- 계약: 도구는 공통 인터페이스(입력/출력/오류/타임아웃/샌드박스)를 준수하며, CLI는 이를 호출·관찰만 합니다.
- 단일 흐름: 도구 통합은 병렬 진행 금지(리스크 축소/원인 파악 용이). 각 통합마다 e2e 확인 후 다음 단계로 진행합니다.

---

## 단계 전환 게이트(Exit Criteria)
다음 게이트를 모두 통과해야 이후 단계로 이동합니다.

| ID | 게이트 | 통과 기준 | 상태 | 개발 코멘트 |
|---|---|---|---|---|
| G1 | CLI 안정화(Phase 1–3) 완료 | `--help/--version` 정상, `config set/get/list` 정상, `init <name>` 표준 구조 생성, 로깅/에러 패턴 문서화, 크로스 플랫폼 경로 점검 | InProgress |  |
| G2 | 도구 등록 규약 확정 | Tool API v0 문서화, 입력/출력/오류 계약, 타임아웃/샌드박스/권한 모델 명시, 레지스트리 설계 | Planned |  |
| G3 | Debate MVP 품질 | 두 에이전트 대화 왕복/중단조건/로그 저장, 재현성 옵션(시드/온도), 실패 복구 메시지 | Planned |  |
| G4 | 개별 도구 통합 품질 | 도구당 통합 체크리스트 100% 완료, 플래그 기본 Off, e2e 데모/로깅/리밋 확인 | Planned |  |
| G5 | 자동화 루프 착수 | Planner 규칙 초안/롤백/최대 사이클/체크포인트 설계 완료 | Planned |  |
| G6 | Export 착수 | 아티팩트 수집기/템플릿 스켈레톤/경로 검증 유틸 초안 | Planned |  |

---

## Phase 1 — CLI 기본 뼈대 구축 (Shell)
목표: 실행 가능한 기본 CLI 골격과 명령 그룹 생성, 버전/도움말 제공
산출물: `cli.py`, `--help`, `--version`, 기본 서브커맨드 스텁

| ID | 과업 | 설명 | 상태 | 개발 코멘트 |
|---|---|---|---|---|
| P1-T01 | Python 버전/환경 정의 | Python 3.10+ 권장, 로컬/가상환경 기준 합의 및 명시 | Done | README.md 반영 |
| P1-T02 | 엔트리 스크립트 초안 | `cli.py` 생성, `if __name__ == "__main__":` 진입부 포함 | Done |  |
| P1-T03 | Click 그룹 생성 | `@click.group()`로 루트 명령 생성, 기본 `--help` 동작 확인 | Done |  |
| P1-T04 | 버전 옵션 | `--version` 플래그 구현, 버전 상수는 단일 소스(`version.py`) | Done |  |
| P1-T05 | 서브커맨드 스텁 | `init`, `run`, `config` 함수 시그니처/도움말만 우선 배치 | Done |  |
| P1-T06 | 로깅 기초 | 콘솔 로거 구성(`INFO` 기본), `--verbose`로 `DEBUG` 전환 | Done |  |
| P1-T07 | 에러 처리/종료코드 | 공통 예외 → 사용자 친화 메시지, 표준 종료코드 맵핑 | Done |  |
| P1-T08 | 의존성 명시 | `requirements.txt`(click 등) 초안, 선택: `pyproject.toml` | Done |  |
| P1-T09 | 사용 예시 검증 | `python cli.py --help/--version` 정상 출력 스냅샷 확보 | Done |  |

---

## Phase 2 — 설정 관리 시스템 (ConfigManager)
목표: API 키 등 민감정보를 안전·영속적으로 저장/조회
산출물: `ConfigManager` 클래스, `config set/get/list` 커맨드, 사용자 홈 경로 설정파일

| ID | 과업 | 설명 | 상태 | 개발 코멘트 |
|---|---|---|---|---|
| P2-T01 | 경로 규격 | 기본 경로: `~/.urban_researcher/config.json` 상수화 | Done |  |
| P2-T02 | 파일 IO/원자성 | 디렉터리 생성, 권한 설정, 원자적 쓰기(임시→교체) | Done |  |
| P2-T03 | set 구현 | `config set --api-key XXXXX` 저장, 마스킹 로깅 | Done |  |
| P2-T04 | get 구현 | `config get --key api-key` 반환, 존재 유무/기본값 처리 | Done |  |
| P2-T05 | list 구현 | 키 목록/마스킹 출력, 포맷 정렬 | Done |  |
| P2-T06 | ENV 우선순위 | 환경변수(예:`UR_API_KEY`)가 파일보다 우선되도록 병합 | Done |  |
| P2-T07 | 검증/오류 | 빈 값/포맷 검증, 예외 메시지 일관화 | Done | 빈 키/값 방지, 친화 메시지 적용 |
| P2-T08 | 간단 테스트 | 수동 e2e: set→get→재실행 유지 확인 | Done |  |

---

## Phase 3 — 프로젝트 관리 시스템 (ProjectManager)
목표: 연구 프로젝트별 표준 디렉터리/메타 관리, 초기화 커맨드 제공
산출물: `ProjectManager`, `init <name>` 커맨드, 표준 폴더 구조 및 `project.json`

표준 폴더(제안): `data/`, `outputs/`, `logs/`, `notes/`

| ID | 과업 | 설명 | 상태 | 개발 코멘트 |
|---|---|---|---|---|
| P3-T01 | 구조 정의 | 프로젝트 루트 및 표준 하위 폴더 스키마 합의/상수화 | Done |  |
| P3-T02 | 메타 파일 | `project.json`(id, name, created_at, version 등) 생성 | Done |  |
| P3-T03 | init 커맨드 | `cli.py init "<name>"` 디렉터리/파일 생성, 재실행 안전 | Done |  |
| P3-T04 | 권한/존재검사 | 이미 존재 시 메시지/`--force` 처리, 퍼미션 점검 | Done |  |
| P3-T05 | 요약 출력 | 생성 후 트리/경로 요약 출력, 다음 액션 힌트 | Done |  |
| P3-T06 | 상태 조회 | `project status`(선택)로 간단 메타/폴더 점검 | Done | 존재/누락 디렉터리 표시 및 알림 |

---

## Phase 4 — 에이전트/대화 시스템 MVP (The Brain)
목표: 대학원생/지도교수 2 에이전트가 주제 기반으로 왕복 대화
산출물: `Agent`, `DebateManager`, `debate` 커맨드, 로그 기록

주: 이 Phase는 도구 통합 없이 “대화” 자체의 안정성을 최우선으로 합니다. 도구는 다음 Phase에서 하나씩 붙입니다.

| ID | 과업 | 설명 | 상태 | 개발 코멘트 |
|---|---|---|---|---|
| P4-T01 | LLM 추상화 | `LLMClient` 인터페이스 설계(프로바이더 교체 용이) |  |  |
| P4-T02 | Agent 클래스 | 페르소나, 시스템 프롬프트, 히스토리/토큰 관리 |  |  |
| P4-T03 | 페르소나 프리셋 | '대학원생', '지도교수' 역할/톤/목표 프롬프트 정의 |  |  |
| P4-T04 | DebateManager | 턴 관리, 최대 라운드, 종료조건/중단 처리 |  |  |
| P4-T05 | CLI 연결 | `debate --topic "..." --max-turns 8` 실행 경로 연결 |  |  |
| P4-T06 | 로그 기록 | 대화 로그를 `logs/debate_YYYYMMDD_HHMM.md` 저장 |  |  |
| P4-T07 | 재현성 옵션 | `--seed`/`--temperature` 등 실험 파라미터 표면화 |  |  |

---

## Phase 5 — 코드 실행기 도구 (CodeInterpreterTool)
목표: 에이전트가 안전하게 코드 실행 및 결과 활용
산출물: `CodeInterpreterTool`, 디베이트 중 도구 호출 연동

주: 도구 통합은 “단일 도구” 단위로 진행하고, 통합 체크리스트(G4)를 모두 충족한 뒤 다음 도구로 이동합니다.

| ID | 과업 | 설명 | 상태 | 개발 코멘트 |
|---|---|---|---|---|
| P5-T01 | 실행기 스펙 | 입력(code 경로/문자열, args), 출력(stdout/stderr, rc, elapsed) |  |  |
| P5-T02 | 보안/격리 | 작업 디렉터리 제한(프로젝트 내부), 타임아웃/메모리 가드 |  |  |
| P5-T03 | 구현 | `subprocess` 기반 실행, 에러 캡처/요약 |  |  |
| P5-T04 | 연동 훅 | DebateManager에서 '대학원생'이 도구 호출 가능하도록 API |  |  |
| P5-T05 | 사용 스위치 | `debate --enable-code`/설정으로 도구 활성화 제어 |  |  |
| P5-T06 | 아카이빙 | 코드/출력/아티팩트 `outputs/`에 버전·타임스탬프 저장 |  |  |

---

## Phase 6 — 문헌/데이터 수집 도구
목표: 외부 지식/데이터 소스와 인터랙션하여 근거 강화
산출물: `LiteratureReviewerTool`, `DataCollectorTool`, MCP 등록

주: CodeInterpreter 통합이 안정(G4)된 이후 순차 통합합니다. 기본은 Off로 출하합니다.

| ID | 과업 | 설명 | 상태 | 개발 코멘트 |
|---|---|---|---|---|
| P6-T01 | 문헌도구 설계 | Semantic Scholar API 스펙/키 설정, 질의/정규화 모델 |  |  |
| P6-T02 | 구현/캐싱 | 호출/에러 처리, `data/cache/` 캐시, 레이트리밋 |  |  |
| P6-T03 | 데이터도구 설계 | 대상 API(공공데이터 등) 1종 선정, 스키마 정의 |  |  |
| P6-T04 | 구현/정제 | 수집→CSV/JSON 정제 파이프라인, 간단 EDA 요약 |  |  |
| P6-T05 | MCP 등록 | 두 도구를 DebateManager에 등록/권한 제어 |  |  |
| P6-T06 | CLI 옵션 | `--enable-literature`, `--enable-data` 등 토글 제공 |  |  |

---

## Phase 7 — 자동화 루프(나선형 연구 고도화)
목표: 토론→계획→실행→평가를 자동 반복하여 연구 심화
산출물: `ResearchPlanner`, `run --auto` 사이클, 실행 로그/체크포인트

주: Planner는 규칙 기반 최소기능으로 시작하고, 실패 시 안전 중단·재시작이 가능해야 합니다.

| ID | 과업 | 설명 | 상태 | 개발 코멘트 |
|---|---|---|---|---|
| P7-T01 | Planner 설계 | 지도교수 제안 문구→실행 가능한 명령 템플릿 매핑 |  |  |
| P7-T02 | 파서/규칙 | 제안 파싱 룰/예외, 변수/통제조건 파라미터 추출 |  |  |
| P7-T03 | 오케스트레이션 | `run --auto`에서 계획→도구 실행→결과→재토론 루프 |  |  |
| P7-T04 | 중단조건 | 최대 사이클/성과 개선 정지/오류 복구/롤백 설계 |  |  |
| P7-T05 | 체크포인트 | 각 스텝 산출물/상태를 프로젝트 메타에 축적 |  |  |
| P7-T06 | 데모 시나리오 | 샘플 분석 스크립트와 함께 e2e 워크스루 작성 |  |  |

---

## Phase 8 — 최종 결과물 생성(보고서 Export)
목표: 전체 과정 로그/결과를 수집하여 논문 형식 초안 생성
산출물: `export` 커맨드, `report.md`(또는 LaTeX) 파일

| ID | 과업 | 설명 | 상태 | 개발 코멘트 |
|---|---|---|---|---|
| P8-T01 | 수집기 | 프로젝트 내 로그/토론/결과/그래프 등 아티팩트 수집 |  |  |
| P8-T02 | 문서 스켈레톤 | IMRaD(서론/방법/결과/논의) 템플릿/메타 삽입 |  |  |
| P8-T03 | LLM 요약 | 핵심 결과/한계/향후과제 초안화(프롬프트/컨텍스트 설계) |  |  |
| P8-T04 | export 커맨드 | `cli.py export`로 산출, 타임스탬프/버전명 포함 |  |  |
| P8-T05 | 링크/이미지 | 이미지/표 경로 상대참조, 파일 존재성 검증 |  |  |
| P8-T06 | 품질 점검 | 기본 맞춤법/포맷/목차 생성(선택) |  |  |

---

## 공통 가이드 및 품질 기준
- 로깅: 모든 커맨드는 시작/종료/에러 로그를 남기고, 실행 인자를 기록합니다.
- 에러 메시지: 사용자가 이해할 수 있는 문장으로 원인/다음 조치 안내를 포함합니다.
- 재현성: 랜덤성 파라미터(시드/온도)를 옵션화하고, 로그에 함께 기록합니다.
- 파일/경로: OS 독립 경로 사용(`pathlib`), 권한/존재 검사 철저.
- 보안: 외부 호출(API/코드 실행)에는 타임아웃/레이트리밋/경계 디렉터리 제한을 둡니다.

### 확장 포인트/플러그인 규약 (Tool API v0, 초안)
- 식별자: `name`, `version`, `capabilities`(예: "code.run", "literature.search")
- 입출력 계약: 입력 스키마(dict), 출력 스키마(dict: `stdout`, `stderr`, `rc`, `artifacts`, `elapsed`, `meta`)
- 실행 인터페이스(개념): `run(ctx: RunContext, **kwargs) -> ToolResult`
- 제약: 프로젝트 경로 밖 파일 접근 금지, 네트워크/시간/메모리 리밋, 취소·타임아웃 지원
- 등록: `ToolRegistry.register(tool)` → DebateManager/Runner가 의존성 주입으로 사용
- 관찰성: 각 호출에 `tool_name`, `args`, `duration`, `exit_code`를 구조화 로그에 남김

### MCP 도구 통합 체크리스트(공통)
| 체크 | 설명 | 상태 | 개발 코멘트 |
|---|---|---|---|
| 스펙 문서 | 입력/출력/에러/리밋 정의 |  |  |
| 설정 키 | 필요한 `config` 키/ENV 정의 |  |  |
| 샌드박스 | 경계 디렉터리/네트워크/리소스 제한 |  |  |
| CLI 토글 | `--enable-<tool>`/기본 Off |  |  |
| 로깅 | 구조화 로그/아카이빙 경로 |  |  |
| 캐시/중복 | 캐시/재시도/백오프 전략 |  |  |
| e2e 데모 | 단일 명령 시나리오/실패 케이스 포함 |  |  |

### 릴리즈 마일스톤(제안)
- M0: CLI 스캐폴드(Phase 1) 통과, 기본 명령 사용 가능
- M1: 설정/프로젝트 안정(Phase 2–3) 및 G1 통과
- M2: Debate MVP(G3) 통과, 로그/종료조건 안정
- M3: CodeInterpreter(G4) 통과, 기본 분석 시나리오 작동
- M4: 문헌/데이터 도구 순차 통합(G4 반복)
- M5: 자동화 루프(Phase 7) 최소기능, 체크포인트/롤백
- M6: Export(Phase 8) 초안 생성, 산출물 검증

## 빌드/검증 스니펫 메모란(자유 양식)
- 최근 빌드 명령: 
  - 예시) `python cli.py --help`
  - 예시) `python cli.py config set --api-key XXXX`
- 실행 로그 요약:
- 발견 이슈/차기 액션:

---

본 문서는 도시연구 CLI 계획서(가상 랩 미팅) 내용을 기반으로 작성되었습니다. 각 과업의 상태/코멘트 갱신을 통해 AI 도구가 자동으로 진행 상황을 추적하고 다음 단계를 제안할 수 있도록 설계되었습니다.
